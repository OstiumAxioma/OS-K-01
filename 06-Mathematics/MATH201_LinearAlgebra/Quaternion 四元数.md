---
date: 2024-05-19
tags:
  - 数学/几何
  - 数学/线性代数
toolSet: 
knowledgeLink:
  - "[[Descriptive Rotation 描述旋转]]"
status: false
---
# 四元数
四元数（英语：Quaternion）是由爱尔兰数学家威廉·卢云·哈密顿在1843年创立出的数学概念。通常记为H，或$\mathbb {H}$。从明确地角度而言，四元数是复数的不可交换延伸。如把四元数的集合考虑成多维实数空间的话，四元数则代表着一个四维空间，相对于复数为二维空间。作为用于描述现实空间的坐标表示方式，人们在复数的基础上创造了四元数并以$a+bi+cj+dk$的形式说明空间点所在位置。 $i$、$j$、$k$作为一种特殊的虚数单位参与运算。

> [!tip] 线性代数与四元数的关系
> 线性代数的诞生晚于四元数，1848年，詹姆斯·西尔维斯特引入矩阵（matrix）用于更方便的理解四元数中呈现的对三维旋转的描述，大大方便了数学家对旋转这一概念的理解，四元数的应用也渐渐淡出视野。然而，随着计算机科学的兴起，人们发现与传统的旋转矩阵相比，使用四元数进行旋转计算具有更高的数值稳定性和更少的计算开销。同时，与欧拉角和旋转矩阵相比，四元数避免了万向死锁（Gimbal Lock）问题，并且插值更加平滑。这使得四元数成为计算机几何与图形学中用来描述旋转的必备工具
## 概念与定义

理解四元数的定义前，我们需要回顾复数：

> [!info] 复数的概念
> 复数是由实数加上虚数单位 𝑖 组成，其中 $i^2=-1$ 

相似地，四元数都是由实数加上三个元素$i,j,k$ 组成，而且它们有如下的关系：

$$
\begin{align}
i^2+j^2+k^2=ijk=-1 \\
i^0+j^0+k^0=ijk=-1
\end{align}
$$

> [!Definition]
> 每个四元数都是 $1,i,j,k$ 的**线性组合**，即四元数$q$一般可表示为：
> $$
> q=w+xi+yj+zk
> $$

其中，$w,x,y,z$ 都是实数系数，$i,j,k$ 则是单位虚数。其中，实数系数$x,y,z$是用于描述旋转轴的单位向量。

要把两个四元数相加只需将相类的系数加起来就可以，就像复数一样。至于乘法则可跟随以下的乘法表：

![[Pasted image 20240519231723.png|center]]
对于$i,j,k$本身的几何意义可以理解为一种旋转，其中:
1. $i$旋转代表<font color="#c0504d">X</font>轴与<font color="#4f81bd">Y</font>轴相交平面中<font color="#c0504d">X</font>轴正向`->`<font color="#4f81bd">Y</font>轴正向的旋转
2. $j$旋转代表<font color="#9bbb59">Z</font>轴与<font color="#c0504d">X</font>轴相交平面中<font color="#9bbb59">Z</font>轴正向`->`<font color="#c0504d">X</font>轴正向的旋转
3. $k$旋转代表<font color="#4f81bd">Y</font>轴与<font color="#9bbb59">Z</font>轴相交平面中<font color="#4f81bd">Y</font>轴正向`->`<font color="#9bbb59">Z</font>轴正向的旋转
## 性质
四元数不像实数或复数那样，它的乘法是<mark class="hltr-red">不可交换</mark>的，例如：
- $ij=k, \quad ji=-k$
- $jk=i, \quad kj=-i$
- $ki=j, \quad ik=-j$
### 单位四元数
单位四元数在描述旋转中必不可少。其定义为：
$$
q=\cos \left(\frac{\theta}{2}\right)+\sin \left(\frac{\theta}{2}\right)(x i+y j+z k)
$$
其中 $\theta$ 是旋转角
### 共轭
数学上，共轭是一个针对复数的概念。
复数的共轭复数（常简称共轭）是对虚部变号的运算。由于四元数是复数的扩展，自然也拥有这一特性。

> [!Definition]
> 共轭四元数是将虚部取反，即给定四元数$q=w+xi+yj+zk$，其共轭四元数$q*=w-xi-yj-zk$
## 四元数计算
### 加法
对应项直接相加即可
### 乘法
两个四元数相乘，并合并相同虚根的对应项，可以用矩阵定义四元数的乘法
$$
\mathbf{p}\otimes\mathbf{q}=\begin{bmatrix}p_wq_w-p_xq_x-p_yq_y-p_zq_z\\p_wq_x+p_xq_w+p_yq_z-p_zq_y\\p_wq_y-p_xq_z+p_yq_w+p_zq_x\\p_wq_z+p_xq_y-p_yq_x+p_zq_w\end{bmatrix}
$$
其中矩阵四行的结果分别对应乘法结果的$1,i,j,k$
## 描述位置
若三维空间里的一个点的笛卡尔坐标为 $(x,y,z)$，则它用**纯四元数**（类似于纯虚数，即实部为0的四元数）$xi+yj+zk$ 表示。
## 描述旋转
四元数是通过使用单位四元数来完成旋转的描述的，遵从以下公式：
$$
\vec{v'}=q \vec{v}q^{-1}
$$
其中：
- $\vec{v'}$ 是旋转后的向量
- $\vec{v}$ 是旋转前的向量
- $q$ 是单位四元数
- $q^{-1}$ 是单位四元数的共轭

四元数描述旋转的步骤如下：
给定三维向量$\vec{v}=(v_x,v_y,v_z)$
1. 将$\vec{v}$表示为一个纯四元数$\vec{v}\rightarrow 0+v_xi+v_yj+v_zk$，**注意：纯四元数的常数项$w$为0
2. 定义旋转四元数：
	1. 选择旋转轴$\vec{u}=(u_x,u_y,u_z)$并[[Vector向量#Vector Normalization|归一化]]
	2. 选择旋转角度$\theta$
	3. 用旋转轴$\vec{u}$计算旋转四元数（单位四元数）：$q=\cos \left(\frac{\theta}{2}\right)+\sin \left(\frac{\theta}{2}\right)(u_xi+u_yj+u_zk)$
3. 计算旋转四元数的共轭：$q^{-1}=\cos \left(\frac{\theta}{2}\right)-\sin \left(\frac{\theta}{2}\right)(u_xi+u_yj+u_zk)$
4. 执行旋转：
	1. 计算$q \vec{v}$
	2. 计算$(q \vec{v})q^{-1}$
5. 根据计算结果，$i,j,k$对应的系数$x,y,z$即是新向量$\vec{v'}$的欧几里得坐标描述
### 建模软件中的四元数旋转
主流建模软件，如blender中，四元数的四个常数系数会被作为参数直接操作。其中，$x,y,z$这四个虚部参数分别对应了绕<font color="#c0504d">X</font><font color="#4f81bd">Y</font><font color="#9bbb59">Z</font>三个轴进行旋转。

值得注意的是，这种旋转不是线性的，在旋转逼近$±180°$的时候速度会逐渐变慢，直到无论如何增加这一轴的值也不会使物体完成$±180°$的旋转。此时只有将实部参数$w$归零才能完成旋转。也就是说，四元数的插值是处于一个范围内的。同时，实部$w$为0的时候，操作任何一个虚部的值也不会有任何作用。